<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VETO Bot Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI'; background: linear-gradient(135deg, #0f0f1e, #16213e); color: #fff; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 30px; padding: 20px; border-bottom: 2px solid #00ff88; }
        h1 { color: #00ff88; font-size: 2.5em; text-shadow: 0 0 20px rgba(0,255,136,0.5); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: rgba(0,255,136,0.1); border: 2px solid #00ff88; padding: 25px; border-radius: 12px; text-align: center; }
        .stat-card h3 { color: #00ff88; margin-bottom: 10px; }
        .stat-card .number { font-size: 2.5em; font-weight: bold; color: #00ffaa; }
        .section { background: rgba(0,0,0,0.4); padding: 30px; border-radius: 15px; margin-bottom: 30px; border: 1px solid rgba(0,255,136,0.2); }
        h2 { color: #00ff88; margin-bottom: 20px; font-size: 1.8em; }
        .upload-area { border: 3px dashed #00ff88; border-radius: 12px; padding: 40px; text-align: center; cursor: pointer; background: rgba(0,255,136,0.05); margin-bottom: 20px; }
        .upload-area:hover { background: rgba(0,255,136,0.15); }
        input[type="text"], textarea, input[type="file"], select { width: 100%; padding: 15px; background: rgba(255,255,255,0.08); border: 2px solid rgba(0,255,136,0.4); color: #fff; border-radius: 8px; font-size: 15px; margin: 10px 0; font-family: inherit; }
        input:focus, textarea:focus, select:focus { outline: none; border-color: #00ffaa; box-shadow: 0 0 15px rgba(0,255,136,0.3); }
        textarea { resize: vertical; min-height: 80px; }
        button { background: linear-gradient(135deg, #00ff88, #00ffaa); color: #000; padding: 12px 30px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin: 10px 5px 10px 0; }
        button:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,255,136,0.4); }
        button.danger { background: #ff4444; color: #fff; }
        .message { padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid; }
        .message.success { background: rgba(0,255,136,0.15); border-color: #00ff88; color: #00ff88; }
        .message.error { background: rgba(255,68,68,0.15); border-color: #ff4444; color: #ff6666; }
        .file-list { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; max-height: 250px; overflow-y: auto; margin: 15px 0; }
        .file-item { background: rgba(0,255,136,0.1); padding: 12px; margin: 8px 0; border-radius: 6px; display: flex; justify-content: space-between; border-left: 3px solid #00ff88; }
        .exception-list { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; max-height: 300px; overflow-y: auto; margin: 15px 0; }
        .exception-item { background: rgba(0,255,136,0.1); padding: 15px; margin: 8px 0; border-radius: 6px; display: flex; justify-content: space-between; border-left: 3px solid #00ff88; }
        .exception-item .username { color: #00ff88; font-weight: bold; flex: 1; }
        .test-result { background: rgba(0,255,136,0.1); padding: 20px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #00ff88; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #00ff88; }
        .tab { padding: 10px 20px; cursor: pointer; border: none; background: transparent; color: #00ff88; font-weight: bold; border-bottom: 3px solid transparent; }
        .tab.active { border-bottom-color: #00ff88; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        #fileInput { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ VETO BOT Dashboard</h1>
            <p style="opacity:0.8;">Instagram Auto-Reply Bot Control Panel</p>
        </header>

        <div class="stats-grid">
            <div class="stat-card"><h3>üìä Training Data</h3><div class="number" id="totalExamples">0</div></div>
            <div class="stat-card"><h3>üö´ Exceptions</h3><div class="number" id="exceptionsCount">0</div></div>
            <div class="stat-card"><h3>‚úÖ Status</h3><div class="number" id="status" style="font-size:1.5em;">ACTIVE</div></div>
        </div>

        <div class="section">
            <h2>üì§ Add Training Data</h2>
            
            <div class="tabs">
                <button class="tab active" onclick="switchTab('upload')">üìÅ Upload File</button>
                <button class="tab" onclick="switchTab('paste')">üìã Paste JSON</button>
                <button class="tab" onclick="switchTab('manual')">‚úçÔ∏è Add Single</button>
            </div>

            <div id="upload" class="tab-content active">
                <div class="upload-area" id="uploadArea">
                    <div style="font-size:3em;margin-bottom:15px;">üìÅ</div>
                    <h3>Drag & Drop or Click to Upload</h3>
                    <button onclick="document.getElementById('fileInput').click()">üìÇ Select Files</button>
                    <input type="file" id="fileInput" accept=".json,.jsonl" multiple/>
                </div>
                <div id="fileList" class="file-list" style="display:none;"></div>
                <button onclick="uploadAllFiles()">‚¨ÜÔ∏è Upload</button>
                <button onclick="clearFiles()" class="danger">üóëÔ∏è Clear</button>
                <div id="uploadMessage"></div>
            </div>

            <div id="paste" class="tab-content">
                <h3 style="color:#00ff88;margin-bottom:10px;">Paste JSON Data</h3>
                <p style="opacity:0.8;margin-bottom:15px;">Paste JSONL (one per line) or JSON array</p>
                <textarea id="jsonPaste" placeholder='[{"instruction": "hi", "response": "hello"}]' style="height:200px;"></textarea>
                <button onclick="pasteJsonData()">üì• Import</button>
                <div id="pasteMessage"></div>
            </div>

            <div id="manual" class="tab-content">
                <input type="text" id="instruction" placeholder="Incoming message">
                <textarea id="response" placeholder="Bot reply"></textarea>
                <button onclick="addData()">‚úÖ Add</button>
                <div id="addMessage"></div>
            </div>
        </div>

        <div class="section">
            <h2>üö´ Exception List</h2>
            <div style="display:flex;gap:10px;">
                <input type="text" id="exceptionUsername" placeholder="Username" style="flex:1;">
                <button onclick="addException()">‚ûï Add</button>
            </div>
            <div id="exceptionMessage"></div>
            <h3 style="color:#00ff88;margin:20px 0 10px 0;">Current:</h3>
            <div class="exception-list" id="exceptionList"><div style="text-align:center;opacity:0.5;">No exceptions</div></div>
        </div>

        <div class="section">
            <h2>üß™ Test Bot</h2>
            <input type="text" id="testMessage" placeholder="Test message">
            <input type="text" id="testUsername" placeholder="Username (optional)">
            <button onclick="testBot()">üöÄ Test</button>
            <div id="testResult"></div>
        </div>
    </div>

    <script>
        const API = window.location.origin;
        let files = [];

        loadStats();
        loadExceptions();
        setInterval(loadStats, 3000);
        setInterval(loadExceptions, 10000);

        document.getElementById('uploadArea').addEventListener('click', () => document.getElementById('fileInput').click());
        document.getElementById('fileInput').addEventListener('change', e => {
            files = Array.from(e.target.files);
            showFiles();
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function showFiles() {
            const list = document.getElementById('fileList');
            if (files.length === 0) {
                list.style.display = 'none';
                return;
            }
            list.style.display = 'block';
            list.innerHTML = files.map((f, i) => `<div class="file-item"><span>üìÑ ${f.name}</span><button class="danger" onclick="removeFile(${i})" style="padding:5px 15px;">‚úñ</button></div>`).join('');
        }

        function removeFile(i) {
            files.splice(i, 1);
            showFiles();
        }

        function clearFiles() {
            files = [];
            document.getElementById('fileInput').value = '';
            showFiles();
        }

        async function uploadAllFiles() {
            if (files.length === 0) {
                showMsg('uploadMessage', 'No files!', 'error');
                return;
            }
            for (let file of files) {
                const fd = new FormData();
                fd.append('file', file);
                try {
                    const res = await fetch(`${API}/upload`, {method: 'POST', body: fd});
                    const data = await res.json();
                    if (data.success) showMsg('uploadMessage', `‚úÖ Added ${data.added}`, 'success');
                    else showMsg('uploadMessage', `‚ùå ${data.error}`, 'error');
                } catch (e) {
                    showMsg('uploadMessage', `‚ùå ${e.message}`, 'error');
                }
            }
            clearFiles();
            loadStats();
        }

        async function pasteJsonData() {
            const jsonText = document.getElementById('jsonPaste').value.trim();
            if (!jsonText) {
                showMsg('pasteMessage', 'Paste JSON!', 'error');
                return;
            }

            try {
                let data;
                try {
                    data = JSON.parse(jsonText);
                    if (!Array.isArray(data)) throw new Error('Array or JSONL');
                } catch (e) {
                    data = [];
                    for (let line of jsonText.split('
')) {
                        line = line.trim();
                        if (line) data.push(JSON.parse(line));
                    }
                }

                let added = 0;
                for (let item of data) {
                    const res = await fetch(`${API}/add_data`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify(item)
                    });
                    const result = await res.json();
                    if (result.success) added++;
                }

                showMsg('pasteMessage', `‚úÖ Added ${added}`, 'success');
                document.getElementById('jsonPaste').value = '';
                loadStats();
            } catch (e) {
                showMsg('pasteMessage', `‚ùå ${e.message}`, 'error');
            }
        }

        async function addException() {
            const user = document.getElementById('exceptionUsername').value.trim();
            if (!user) {
                showMsg('exceptionMessage', 'Enter username!', 'error');
                return;
            }
            try {
                const res = await fetch(`${API}/exception/add`, {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({username: user})});
                const data = await res.json();
                if (data.success) {
                    showMsg('exceptionMessage', `‚úÖ ${data.message}`, 'success');
                    document.getElementById('exceptionUsername').value = '';
                    loadExceptions();
                    loadStats();
                } else {
                    showMsg('exceptionMessage', `‚ùå ${data.message}`, 'error');
                }
            } catch (e) {
                showMsg('exceptionMessage', `‚ùå ${e.message}`, 'error');
            }
        }

        async function removeException(user) {
            try {
                const res = await fetch(`${API}/exception/remove`, {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({username: user})});
                const data = await res.json();
                if (data.success) {
                    loadExceptions();
                    loadStats();
                }
            } catch (e) {
                console.error(e);
            }
        }

        async function loadExceptions() {
            try {
                const res = await fetch(`${API}/exception/list`);
                const data = await res.json();
                const list = document.getElementById('exceptionList');
                if (data.exceptions && data.exceptions.length > 0) {
                    list.innerHTML = data.exceptions.map(u => `<div class="exception-item"><span class="username">@${u}</span><button class="danger" onclick="removeException('${u}')" style="padding:8px 15px;">‚úñ</button></div>`).join('');
                } else {
                    list.innerHTML = '<div style="text-align:center;opacity:0.5;">No exceptions</div>';
                }
            } catch (e) {
                console.error(e);
            }
        }

        async function addData() {
            const inst = document.getElementById('instruction').value.trim();
            const resp = document.getElementById('response').value.trim();
            if (!inst || !resp) {
                showMsg('addMessage', 'Both required!', 'error');
                return;
            }
            try {
                const res = await fetch(`${API}/add_data`, {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({instruction: inst, response: resp})});
                const data = await res.json();
                if (data.success) {
                    showMsg('addMessage', `‚úÖ Added! Total: ${data.total}`, 'success');
                    document.getElementById('instruction').value = '';
                    document.getElementById('response').value = '';
                    loadStats();
                } else {
                    showMsg('addMessage', `‚ùå ${data.error}`, 'error');
                }
            } catch (e) {
                showMsg('addMessage', `‚ùå ${e.message}`, 'error');
            }
        }

        async function testBot() {
            const msg = document.getElementById('testMessage').value;
            const user = document.getElementById('testUsername').value;
            if (!msg) {
                showMsg('testResult', 'Enter message!', 'error');
                return;
            }
            try {
                const res = await fetch(`${API}/test`, {method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({message: msg, username: user})});
                const data = await res.json();
                let html = '<div class="test-result">';
                if (msg) html += `<strong>Message:</strong> ${msg}<br>`;
                if (user) html += `<strong>User:</strong> @${user}<br>`;
                html += `<br><strong style="color:#00ffaa;">Bot:</strong> ${data.response}`;
                if (data.excepted) html += `<br><span style="color:#ff6666;"><strong>‚ö†Ô∏è Excepted</strong></span>`;
                html += '</div>';
                document.getElementById('testResult').innerHTML = html;
            } catch (e) {
                showMsg('testResult', `‚ùå ${e.message}`, 'error');
            }
        }

        async function loadStats() {
            try {
                const res = await fetch(`${API}/stats`);
                const data = await res.json();
                document.getElementById('totalExamples').textContent = data.total_examples || 0;
                document.getElementById('exceptionsCount').textContent = data.exceptions || 0;
                document.getElementById('status').textContent = (data.status || 'ACTIVE').toUpperCase();
            } catch (e) {
                console.error(e);
            }
        }

        function showMsg(id, msg, type) {
            document.getElementById(id).innerHTML = `<div class="message ${type}">${msg}</div>`;
        }
    </script>
</body>
</html>
