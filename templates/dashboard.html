<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VETO Bot Dashboard</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI';background:linear-gradient(135deg,#0f0f1e,#16213e);color:#fff;min-height:100vh;padding:20px}
.container{max-width:1200px;margin:0 auto}
header{text-align:center;margin-bottom:30px;padding:20px;border-bottom:2px solid #00ff88}
h1{color:#00ff88;font-size:2.5em;text-shadow:0 0 20px rgba(0,255,136,.5)}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}
.stat-card{background:rgba(0,255,136,.1);border:2px solid #00ff88;padding:25px;border-radius:12px;text-align:center}
.stat-card h3{color:#00ff88;margin-bottom:10px}
.stat-card .number{font-size:2.5em;font-weight:bold;color:#00ffaa}
.section{background:rgba(0,0,0,.4);padding:30px;border-radius:15px;margin-bottom:30px;border:1px solid rgba(0,255,136,.2)}
h2{color:#00ff88;margin-bottom:20px}
.tabs{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
.tab{padding:10px 20px;cursor:pointer;border:2px solid rgba(0,255,136,.3);background:rgba(0,255,136,.1);color:#00ff88;font-weight:bold;border-radius:8px}
.tab.active{background:linear-gradient(135deg,#00ff88,#00ffaa);color:#000}
.tab-content{display:none}
.tab-content.active{display:block}
.upload-area{border:3px dashed #00ff88;border-radius:12px;padding:40px;text-align:center;cursor:pointer;background:rgba(0,255,136,.05);margin-bottom:20px}
.upload-area:hover{background:rgba(0,255,136,.15)}
input,textarea,select{width:100%;padding:15px;background:rgba(255,255,255,.08);border:2px solid rgba(0,255,136,.4);color:#fff;border-radius:8px;margin:10px 0;font-family:inherit}
input:focus,textarea:focus,select:focus{outline:0;border-color:#00ffaa;box-shadow:0 0 15px rgba(0,255,136,.3)}
button{background:linear-gradient(135deg,#00ff88,#00ffaa);color:#000;padding:12px 30px;border:none;border-radius:8px;font-weight:bold;cursor:pointer;margin:10px 5px 10px 0}
button:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,255,136,.4)}
button.danger{background:#ff4444;color:#fff}
.message{padding:15px;border-radius:8px;margin:15px 0;border-left:4px solid}
.message.success{background:rgba(0,255,136,.15);border-color:#00ff88;color:#00ff88}
.message.error{background:rgba(255,68,68,.15);border-color:#ff4444;color:#ff6666}
.exception-list{background:rgba(0,0,0,.3);padding:15px;border-radius:8px;max-height:300px;overflow-y:auto;margin:15px 0}
.exception-item{background:rgba(0,255,136,.1);padding:12px;margin:8px 0;border-radius:6px;display:flex;justify-content:space-between;border-left:3px solid #00ff88}
.test-result{background:rgba(0,255,136,.1);padding:20px;border-radius:8px;margin-top:20px;border-left:4px solid #00ff88}
#fileInput{display:none}
</style>
</head>
<body>
<div class="container">
<header><h1>ü§ñ VETO BOT Dashboard</h1><p style="opacity:.8">Instagram Auto-Reply Bot</p></header>
<div class="stats-grid">
<div class="stat-card"><h3>üìä Training</h3><div class="number" id="totalExamples">0</div></div>
<div class="stat-card"><h3>üö´ Exceptions</h3><div class="number" id="exceptionsCount">0</div></div>
<div class="stat-card"><h3>‚úÖ Status</h3><div class="number" id="status">ACTIVE</div></div>
</div>
<div class="section">
<h2>üì§ Add Training Data</h2>
<div class="tabs">
<button class="tab active" onclick="switchTab(0,this)">üìÅ Upload</button>
<button class="tab" onclick="switchTab(1,this)">üìã Paste JSON</button>
<button class="tab" onclick="switchTab(2,this)">‚úçÔ∏è Manual</button>
</div>
<div class="tab-content active">
<div class="upload-area" onclick="document.getElementById('fileInput').click()"><div style="font-size:3em;margin-bottom:15px">üìÅ</div><h3>Click to Upload</h3><input type="file" id="fileInput" accept=".json,.jsonl" multiple></div>
<button onclick="uploadFiles()">Upload</button><div id="uploadMsg"></div>
</div>
<div class="tab-content">
<textarea id="jsonPaste" placeholder='[{"instruction":"hi","response":"hello"}]' style="height:150px"></textarea>
<button onclick="importJson()">Import</button><div id="pasteMsg"></div>
</div>
<div class="tab-content">
<input type="text" id="instruction" placeholder="Message"><textarea id="response" placeholder="Reply" style="height:80px"></textarea>
<button onclick="addManual()">Add</button><div id="manualMsg"></div>
</div>
</div>
<div class="section">
<h2>üö´ Exceptions</h2>
<div style="display:flex;gap:10px"><input type="text" id="exceptionUser" placeholder="Username" style="flex:1"><button onclick="addException()">Add</button></div>
<div id="exceptionMsg"></div>
<div class="exception-list" id="exceptionList"><div style="text-align:center;opacity:.5">No exceptions</div></div>
</div>
<div class="section">
<h2>üß™ Test</h2>
<input type="text" id="testMessage" placeholder="Message"><button onclick="testBot()">Test</button><div id="testResult"></div>
</div>
</div>
<script>
const API=window.location.origin;
let files=[];
loadStats();
loadExceptions();
setInterval(loadStats,3000);
setInterval(loadExceptions,5000);
document.getElementById('fileInput').addEventListener('change',e=>{files=Array.from(e.target.files)});
function switchTab(n,btn){
  document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(el=>el.classList.remove('active'));
  document.querySelectorAll('.tab-content')[n].classList.add('active');
  btn.classList.add('active');
}
async function uploadFiles(){
  if(files.length===0){showMsg('uploadMsg','Select files!','error');return}
  for(let f of files){
    let fd=new FormData();fd.append('file',f);
    try{
      let res=await fetch(API+'/upload',{method:'POST',body:fd});
      let data=await res.json();
      showMsg('uploadMsg','‚úÖ Added '+data.added,'success');
    }catch(e){showMsg('uploadMsg','‚ùå '+e.message,'error')}
  }
  files=[];loadStats();
}
async function importJson(){
  let text=document.getElementById('jsonPaste').value.trim();
  if(!text){showMsg('pasteMsg','Paste data!','error');return}
  try{
    let data=JSON.parse(text);
    if(!Array.isArray(data))throw new Error('Array');
    let added=0;
    for(let item of data){
      let res=await fetch(API+'/add_data',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(item)});
      let r=await res.json();if(r.success)added++;
    }
    showMsg('pasteMsg','‚úÖ Added '+added,'success');
    document.getElementById('jsonPaste').value='';
    loadStats();
  }catch(e){showMsg('pasteMsg','‚ùå '+e.message,'error')}
}
async function addManual(){
  let inst=document.getElementById('instruction').value.trim();
  let resp=document.getElementById('response').value.trim();
  if(!inst||!resp){showMsg('manualMsg','Both required!','error');return}
  try{
    let res=await fetch(API+'/add_data',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({instruction:inst,response:resp})});
    let data=await res.json();
    if(data.success){
      showMsg('manualMsg','‚úÖ Added!','success');
      document.getElementById('instruction').value='';
      document.getElementById('response').value='';
      loadStats();
    }else showMsg('manualMsg','‚ùå '+data.error,'error');
  }catch(e){showMsg('manualMsg','‚ùå '+e.message,'error')}
}
async function addException(){
  let user=document.getElementById('exceptionUser').value.trim();
  if(!user){showMsg('exceptionMsg','Enter username!','error');return}
  try{
    let res=await fetch(API+'/exception/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:user})});
    let data=await res.json();
    if(data.success){
      showMsg('exceptionMsg','‚úÖ Added','success');
      document.getElementById('exceptionUser').value='';
      loadExceptions();
      loadStats();
    }else showMsg('exceptionMsg','‚ùå '+data.message,'error');
  }catch(e){showMsg('exceptionMsg','‚ùå '+e.message,'error')}
}
async function removeException(user){
  try{
    await fetch(API+'/exception/remove',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:user})});
    loadExceptions();loadStats();
  }catch(e){}
}
async function loadExceptions(){
  try{
    let res=await fetch(API+'/exception/list');
    let data=await res.json();
    let list=document.getElementById('exceptionList');
    if(data.exceptions&&data.exceptions.length>0){
      list.innerHTML=data.exceptions.map(u=>`<div class="exception-item"><span style="color:#00ff88;font-weight:bold">@${u}</span><button class="danger" onclick="removeException('${u}')">Remove</button></div>`).join('');
    }else list.innerHTML='<div style="text-align:center;opacity:.5">No exceptions</div>';
  }catch(e){console.error(e)}
}
async function testBot(){
  let msg=document.getElementById('testMessage').value;
  if(!msg){showMsg('testResult','Enter message!','error');return}
  try{
    let res=await fetch(API+'/test',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:msg})});
    let data=await res.json();
    document.getElementById('testResult').innerHTML='<div class="test-result"><strong>Bot:</strong> '+data.response+'</div>';
  }catch(e){showMsg('testResult','‚ùå '+e.message,'error')}
}
async function loadStats(){
  try{
    let res=await fetch(API+'/stats');
    let data=await res.json();
    document.getElementById('totalExamples').textContent=data.total_examples||0;
    document.getElementById('exceptionsCount').textContent=data.exceptions||0;
  }catch(e){console.error(e)}
}
function showMsg(id,msg,type){
  document.getElementById(id).innerHTML='<div class="message '+type+'">'+msg+'</div>';
}
</script>
</body>
</html>
